@extends('master')

@section('title', 'ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸàÿßÿπÿØ ÿßŸÑÿ≠ÿ∂Ÿàÿ±')

@section('content')
    <!-- Header Section -->
    <div class="content-header row">
        <div class="content-header-left col-md-9 col-12 mb-2">
            <div class="row breadcrumbs-top">
                <div class="col-12">
                    <h2 class="content-header-title float-left mb-0">ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸàÿßÿπÿØ ÿßŸÑÿ≠ÿ∂Ÿàÿ±</h2>
                    <div class="breadcrumb-wrapper col-12">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a></li>
                            <li class="breadcrumb-item"><a href="{{ route('attendance-rules.index') }}">ŸÇŸàÿßÿπÿØ ÿßŸÑÿ≠ÿ∂Ÿàÿ±</a></li>
                            <li class="breadcrumb-item active">ÿ•ÿ∂ÿßŸÅÿ©</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Actions -->
    <div class="card mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div>
                    <label>ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ™Ÿä ÿπŸÑŸäŸáÿß ÿπŸÑÿßŸÖÿ© <span style="color: red">*</span> ÿßŸÑÿ≤ÿßŸÖŸäÿ©</label>
                </div>
                <div>
                    <a href="{{ route('attendance-rules.index') }}" class="btn btn-outline-danger">
                        <i class="fa fa-ban"></i> ÿ•ŸÑÿ∫ÿßÿ°
                    </a>
                    <button type="submit" form="createForm" class="btn btn-outline-primary">
                        <i class="fa fa-save"></i> ÿ≠ŸÅÿ∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="cart mt-5">
        <div class="card">
            <div class="card-header text-center">
                <h4>ŸÇŸàÿßÿπÿØ ÿßŸÑÿ≠ÿ∂Ÿàÿ±</h4>
            </div>
            <div class="card-body">
                <form id="createForm" action="{{ route('attendance-rules.store') }}" method="POST">
                    @csrf

                    <!-- ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ: ÿßŸÑÿßÿ≥ŸÖ ŸàÿßŸÑŸÑŸàŸÜ -->
                    <div class="row mb-3">
                        <!-- ÿßŸÑÿßÿ≥ŸÖ -->
                        <div class="col-md-6">
                            <label for="name" class="form-label">ÿßŸÑÿßÿ≥ŸÖ: <span style="color: red">*</span></label>
                            <input type="text"
                                   class="form-control @error('name') is-invalid @enderror"
                                   id="name"
                                   name="name"
                                   value="{{ old('name') }}"
                                   placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿßÿ≥ŸÖ"
                                   required>
                            @error('name')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- ÿßŸÑŸÑŸàŸÜ -->
                        <div class="col-md-6">
                            <label for="color" class="form-label">ÿßŸÑŸÑŸàŸÜ:</label>
                            <div class="d-flex align-items-center">
                                <input type="color"
                                       class="form-control form-control-color @error('color') is-invalid @enderror"
                                       id="color"
                                       name="color"
                                       value="{{ old('color', '#4e5381') }}"
                                       title="ÿßÿÆÿ™ÿ± ÿßŸÑŸÑŸàŸÜ"
                                       style="max-width: 50px; margin-left: 10px;">
                                <input type="text"
                                       class="form-control"
                                       id="colorDisplay"
                                       value="{{ old('color', '#4e5381') }}"
                                       readonly>
                            </div>
                            @error('color')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>
                    </div>

                    <!-- ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä: ÿßŸÑÿ≠ÿßŸÑÿ© ŸàÿßŸÑŸàÿ±ÿØŸäÿ© -->
                    <div class="row mb-3">
                        <!-- ÿßŸÑÿ≠ÿßŸÑÿ© -->
                        <div class="col-md-6">
                            <label for="status" class="form-label">ÿßŸÑÿ≠ÿßŸÑÿ©: <span style="color: red">*</span></label>
                            <select class="form-control select2 @error('status') is-invalid @enderror"
                                    id="status"
                                    name="status"
                                    required>
                                <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>ŸÜÿ¥ÿ∑</option>
                                <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑</option>
                            </select>
                            @error('status')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- ÿßŸÑŸàÿ±ÿØŸäÿ© -->
                        <div class="col-md-6">
                            <label for="shift" class="form-label">ÿßŸÑŸàÿ±ÿØŸäÿ©: <span style="color: red">*</span></label>
                            <select class="form-control select2 @error('shift_id') is-invalid @enderror"
                                    id="shift"
                                    name="shift_id"
                                    required>
                                <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸàÿ±ÿØŸäÿ©</option>
                                @foreach ($shifts as $shift)
                                    <option value="{{ $shift->id }}"
                                            {{ old('shift_id') == $shift->id ? 'selected' : '' }}>
                                        {{ $shift->name }}
                                    </option>
                                @endforeach
                            </select>
                            @error('shift_id')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>
                    </div>

                    <!-- ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´: ÿßŸÑŸàÿµŸÅ (ÿπÿ±ÿ∂ ŸÉÿßŸÖŸÑ) -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <label for="description" class="form-label">ÿßŸÑŸàÿµŸÅ:</label>
                            <textarea class="form-control @error('description') is-invalid @enderror"
                                      id="description"
                                      name="description"
                                      rows="3"
                                      placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸàÿµŸÅ">{{ old('description') }}</textarea>
                            @error('description')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>
                    </div>

                    <!-- ÿßŸÑÿµŸÅ ÿßŸÑÿ±ÿßÿ®ÿπ: ÿßŸÑÿµŸäÿ∫ÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®Ÿäÿ© ŸàÿßŸÑÿ¥ÿ±ÿ∑ -->
                    <div class="row mb-3">
                        <!-- ÿßŸÑÿµŸäÿ∫ÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®Ÿäÿ© -->
                        <div class="col-md-6">
                            <label for="formula" class="form-label">ÿßŸÑÿµŸäÿ∫ÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®Ÿäÿ©:</label>
                            <div class="input-group">
                                <button class="btn btn-outline-secondary" type="button">üîç</button>
                                <input type="text"
                                       class="form-control @error('formula') is-invalid @enderror"
                                       id="formula"
                                       name="formula"
                                       value="{{ old('formula') }}"
                                       placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿµŸäÿ∫ÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®Ÿäÿ©">
                            </div>
                            @error('formula')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>

                        <!-- ÿßŸÑÿ¥ÿ±ÿ∑ -->
                        <div class="col-md-6">
                            <label for="condition" class="form-label">ÿßŸÑÿ¥ÿ±ÿ∑:</label>
                            <div class="input-group">
                                <button class="btn btn-outline-secondary" type="button">üîç</button>
                                <input type="text"
                                       class="form-control @error('condition') is-invalid @enderror"
                                       id="condition"
                                       name="condition"
                                       value="{{ old('condition') }}"
                                       placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿ¥ÿ±ÿ∑">
                            </div>
                            @error('condition')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>

@endsection

@push('scripts')
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
$(document).ready(function() {
    // Initialize Select2
    $('.select2').select2({
        dir: 'rtl',
        language: 'ar'
    });

    // Color picker functionality
    $('#color').on('change', function() {
        $('#colorDisplay').val($(this).val());
    });

    // Form submission with SweetAlert
    $('#createForm').on('submit', function(e) {
        e.preventDefault();

        // Validate required fields
        let isValid = true;
        const requiredFields = ['name', 'status', 'shift_id'];

        requiredFields.forEach(function(field) {
            const fieldElement = document.getElementById(field === 'shift_id' ? 'shift' : field);
            if (!fieldElement.value.trim()) {
                isValid = false;
                fieldElement.classList.add('is-invalid');
            } else {
                fieldElement.classList.remove('is-invalid');
            }
        });

        if (!isValid) {
            Swal.fire({
                icon: 'error',
                title: 'ÿÆÿ∑ÿ£!',
                text: 'Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©',
                confirmButtonText: 'ŸÖŸàÿßŸÅŸÇ'
            });
            return;
        }

        Swal.fire({
            title: 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØÿü',
            text: 'ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿ≠ÿ∂Ÿàÿ± ÿ¨ÿØŸäÿØÿ©',
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'ŸÜÿπŸÖÿå ÿßÿ≠ŸÅÿ∏',
            cancelButtonText: 'ÿ•ŸÑÿ∫ÿßÿ°',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                // Show loading
                Swal.fire({
                    title: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏...',
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    showConfirmButton: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                // Submit form
                this.submit();
            }
        });
    });

    // Display success message if exists
    @if(session('success'))
        Swal.fire({
            icon: 'success',
            title: 'ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠!',
            text: '{{ session('success') }}',
            confirmButtonText: 'ŸÖŸàÿßŸÅŸÇ'
        });
    @endif

    // Display error message if exists
    @if(session('error'))
        Swal.fire({
            icon: 'error',
            title: 'ÿÆÿ∑ÿ£!',
            text: '{{ session('error') }}',
            confirmButtonText: 'ŸÖŸàÿßŸÅŸÇ'
        });
    @endif

    // Display validation errors
    @if($errors->any())
        let errorMessages = '';
        @foreach($errors->all() as $error)
            errorMessages += '‚Ä¢ {{ $error }}\n';
        @endforeach

        Swal.fire({
            icon: 'error',
            title: 'ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿØÿÆŸÑÿ©',
            text: errorMessages,
            confirmButtonText: 'ŸÖŸàÿßŸÅŸÇ'
        });
    @endif
});
</script>
@endpush